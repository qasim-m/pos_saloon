<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script type="text/javascript">
  $(function() {

      var start = moment().subtract(29, 'days');
      var end = moment();

      function cb(start, end) {
          $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
      }

      $('#reportrange').daterangepicker({
          startDate: start,
          endDate: end,
          ranges: {
            'Today': [moment(), moment()],
            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month': [moment().startOf('month'), moment().endOf('month')],
            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          }
      }, cb);

      cb(start, end);

  });
</script>
<script>
  $(document).ready(function(){
      $(".toggler").click(function(e){
          e.preventDefault();
          $('.cat'+$(this).attr('data-prod-cat')).toggle();
      });
  });
</script>

<h4> <%= link_to " Back to HomePage", root_path %> </h4>
<br>
<h4>Your Sales</h4>
<br>

<div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 2px solid #ccc; width: 30%">
    <i class="fa fa-calendar"></i>&nbsp;
    <span></span> <i class="fa fa-caret-down"></i>
</div>
<br>

<table class="table table-striped-columns" style="max-width: 60rem;">
    <tr class="table-info">
      <th>Provider Name</th>
      <th>Date/Time</th>
      <th>Payment Type</th>
      <th>Total Amount</th>
      <th>Customer Name</th>
      <th>Customer Phone</th>
      <th>Show/Hide</th>
    </tr>
    <% @sales.each_with_index do |sale, idx| %>
      <tr class="table-secondary">
        <td><%=[sale.user.first_name , sale.user.last_name].join(" ") %></td>
        <td><%= DateTime.parse(sale.created_at.to_s).strftime("%d-%m-%Y %I:%M %p") %></td>
        <td><%= sale.payment_methode %> </td>
        <td><%= sale.total %> </td>
        <td><%= sale.customer.name %></td>
        <td ><%= sale.customer.phone %></td>
        <td><a href="#" class="toggler" data-prod-cat= <%(idx +1).to_s%> >+</a></td>
      </tr>
     
      <tr class="table-success cat<%(idx +1).to_s%>" style="display:none">
        <th>Service Name</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
      <% sale.sale_services.each do |sale_service| %>
        <tr class= "cat<%(idx +1).to_s%>" style="display:none">
          <td><%= sale_service.service.name %> </td>
          <td><%= sale_service.price %></td>
          <td><%= sale_service.qty %></td>
        </tr>
      <% end %>
    <% end %>
</table>
